<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËÅñË™ïÊãâÈú∏Ê¥ªÂãï</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        /* --- V5 RWD Ê®£Âºè (WIX ÂÆåÁæéÈÅ©ÈÖçÁâà) --- */
        * { box-sizing: border-box; }
        body {
            font-family: 'Arial', sans-serif;
            background-color: #1a472a;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100vw;
            margin: 0;
            padding: 10px;
            overflow: hidden;
        }
        h1 {
            color: #f0c419;
            text-shadow: 2px 2px 4px #000;
            margin-bottom: 10px;
            font-size: clamp(1.5rem, 5vw, 2rem);
            text-align: center;
        }
        .info-text { font-size: 1rem; color: #ddd; margin-bottom: 15px; text-align: center;}
        .count-badge { background: #2980b9; padding: 5px 15px; border-radius: 15px; font-weight: bold; color: #fff; }
        .machine-container {
            background-color: #c0392b;
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            border: 5px solid #f0c419;
            width: 95%;
            max-width: 350px;
            min-width: 280px;
            text-align: center;
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .slots-window {
            background-color: #fff;
            border-radius: 10px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 10px 5px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
            width: 100%;
        }
        .reel {
            font-size: clamp(2.5rem, 10vw, 3.5rem);
            width: 33%;
            height: 70px;
            line-height: 75px;
            text-align: center;
            border-right: 2px solid #ddd;
            color: #333;
            display: flex; align-items: center; justify-content: center;
        }
        .reel:last-child { border-right: none; }
        .reel img { width: 80%; height: 80%; object-fit: contain; }
        .spin-btn {
            background: linear-gradient(to bottom, #f0c419, #d4ac0d);
            border: none;
            padding: 15px 0;
            width: 100%;
            font-size: 1.5rem;
            color: #333;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 0 #997c09;
        }
        .spin-btn:active { transform: translateY(5px); box-shadow: 0 0 0 #997c09; }
        .spin-btn:disabled { background: #95a5a6; color: #555; cursor: not-allowed; box-shadow: none; transform: translateY(5px); }
        
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center; align-items: center;
            z-index: 1000; backdrop-filter: blur(5px);
            padding: 20px;
        }
        .modal-content {
            background: #fff; color: #333;
            width: 100%; max-width: 320px;
            padding: 30px 20px; border-radius: 20px;
            text-align: center; position: relative;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            border: 4px solid #c0392b;
            animation: popIn 0.3s ease-out;
        }
        @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .modal-img-placeholder {
            width: 120px; height: 120px;
            background-color: #fafafa;
            margin: 0 auto 15px;
            display: flex; align-items: center; justify-content: center;
            font-size: 4rem;
            border-radius: 10px; border: 2px dashed #ccc;
        }
        .modal-img-placeholder img { width: 100%; height: 100%; object-fit: cover; border-radius: 10px; }
        .modal-title { font-size: 1.5rem; color: #c0392b; margin-bottom: 10px; font-weight: bold; }
        .modal-desc { font-size: 0.95rem; color: #555; margin-bottom: 20px; line-height: 1.5; white-space: pre-line; text-align: left; padding: 0 10px;}
        .close-btn { background: #2ecc71; color: white; border: none; padding: 10px 30px; border-radius: 30px; font-size: 1.2rem; cursor: pointer; width: 100%; }
        .snow { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; background-image: url('data:image/svg+xml;utf8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="10" height="10"><circle cx="5" cy="5" r="2" fill="white" opacity="0.3"/></svg>'); animation: snow 10s linear infinite; }
        @keyframes snow { from { background-position: 0 0; } to { background-position: 0 500px; } }
    </style>
</head>
<body>
    <div class="snow"></div>
    <h1 id="welcome-msg">üéÑ ËÅñË™ïÂ•ΩÁ¶ÆÊãâÈú∏ üéÑ</h1>
    <div class="info-text" id="status-msg">ÈÄ£Á∑ö‰∏≠...</div>
    
    <div class="machine-container">
        <div class="slots-window">
            <div class="reel" id="reel1">üéÖ</div>
            <div class="reel" id="reel2">üéÖ</div>
            <div class="reel" id="reel3">üéÖ</div>
        </div>
        <button class="spin-btn" id="spinBtn" onclick="playGame()" disabled>ËºâÂÖ•‰∏≠...</button>
    </div>

    <div class="modal-overlay" id="prizeModal">
        <div class="modal-content">
            <div class="modal-img-placeholder" id="modalImg">üéÅ</div>
            <div class="modal-title" id="modalTitle">Ê®ôÈ°å</div>
            <div class="modal-desc" id="modalDesc">ÊïòËø∞</div>
            <button class="close-btn" onclick="closeModal()">Á´ãÂç≥È†òÂèñ</button>
        </div>
    </div>

    <script>
        // ‚úÖ ‰Ω†ÁöÑ ID Â∑≤Á∂ìÂ°´Â•Ω‰∫Ü
        const YOUR_LIFF_ID = "2008607102-ZKoAeEga"; 

        let testCount = 0;
        let userId = "";
        let userName = "";

        // --- LINE LIFF ÂàùÂßãÂåñ ---
        function initLineLiff() {
            document.getElementById('status-msg').innerText = "Ê≠£Âú®ÈÄ£Êé• LINE...";
            
            // ÂòóË©¶ÂàùÂßãÂåñ
            liff.init({ liffId: YOUR_LIFF_ID })
                .then(() => {
                    if (!liff.isLoggedIn()) {
                        // Ê≤íÁôªÂÖ•Â∞±Â∞éÂêëÁôªÂÖ•È†Å
                        liff.login();
                    } else {
                        // Â∑≤ÁôªÂÖ•ÔºåÈñãÂßãÊäìË≥áÊñô
                        getProfile();
                    }
                })
                .catch((err) => {
                    console.error('LIFF Error:', err);
                    // ÈåØË™§ËôïÁêÜÔºöÂ¶ÇÊûú‰∏çÊòØÂú® LINE ÈñãÂïüÔºåÊàñË®≠ÂÆöÊúâË™§
                    document.getElementById('status-msg').innerHTML = "Ê∏¨Ë©¶Ê®°Âºè (Êú™ÈÄ£Êé• LINE)";
                    document.getElementById('spinBtn').disabled = false;
                    document.getElementById('spinBtn').innerText = "Ë©¶Ë©¶ÊâãÊ∞£";
                });
        }

        function getProfile() {
            liff.getProfile()
                .then(profile => {
                    userId = profile.userId;
                    userName = profile.displayName;
                    
                    // ‰øÆÊîπÁï´Èù¢‰∏äÊñπÊñáÂ≠óÔºåÈ°ØÁ§∫Áî®Êà∂ÂêçÂ≠ó
                    document.getElementById('welcome-msg').innerText = `üéÑ ${userName} ÁöÑËÅñË™ïÊãâÈú∏ üéÑ`;
                    document.getElementById('status-msg').innerText = `Hello, ${userName}ÔºÅÁ•ù‰Ω†Â•ΩÈÅãÔºÅ`;
                    
                    // Ëß£ÈéñÊåâÈàï
                    document.getElementById('spinBtn').disabled = false;
                    document.getElementById('spinBtn').innerText = "Ë©¶Ë©¶ÊâãÊ∞£";
                })
                .catch(err => {
                    console.error('Profile Error:', err);
                    document.getElementById('status-msg').innerText = "ÁÑ°Ê≥ïÂèñÂæóË≥áÊñôÔºå‰ΩÜ‰ªçÂèØÈÅäÁé©";
                    document.getElementById('spinBtn').disabled = false;
                });
        }

        // --- ÈÅäÊà≤ÈÇèËºØ ---
        const prizes = [
            { id: 'off_80', type: 'coupon', symbol: 'üëë', weight: 1, image: '', text: 'üéâ ËÅñË™ïÂ•áËπüÈôçËá®ÔºÅ', desc: 'Â§™‰∏çÂèØÊÄùË≠∞‰∫ÜÔºÅÁç≤Âæó„ÄêÊï¥Á≠ÜË®ÇÂñÆ 8 Êäò„ÄëË∂ÖÁ¥öÂÑ™ÊÉ†ÔºåÂø´Ê∏ÖÁ©∫‰Ω†ÁöÑË≥ºÁâ©ËªäÔºÅ' },
            { id: 'off_90', type: 'coupon', symbol: 'üé´', weight: 5, image: '', text: '‚ú® Âπ∏ÈÅãÊòüÊòØ‰Ω†ÔºÅ', desc: 'ÊÅ≠ÂñúÁç≤Âæó„ÄêÊï¥Á≠ÜË®ÇÂñÆ 9 Êäò„ÄëÔºÅËÅñË™ïÁØÄÂ∞±ÊòØË¶ÅÂ∞çËá™Â∑±Â•Ω‰∏ÄÈªûÔºÅ' },
            { id: 'cash_1000', type: 'coupon', symbol: 'üí∞', weight: 10, image: '', text: 'üî• Â§©ÈÅ∏‰πã‰∫∫ÊòØ‰Ω†ÔºÅ', desc: 'ÊâãÊ∞£Â§™Êó∫‰∫ÜÂêßÔºÅË±™ÈÄÅ„Äê1000ÂÖÉË≥ºÁâ©Èáë„ÄëÔºåËÄÅÈóÜÁúãÂà∞ÈÉΩË¶ÅÂì≠‰∫ÜÔºÅ' },
            { id: 'cash_500', type: 'coupon', symbol: 'üí∞', weight: 20, image: '', text: 'üéÖ ËÅñË™ïÂ§ßÁ¥ÖÂåÖÔºÅ', desc: 'ÊÅ≠ÂñúÁôºË≤°ÔºÅÁç≤Âæó„Äê500ÂÖÉË≥ºÁâ©Èáë„ÄëÔºåË≤∑‰ªΩÂ§ßÁ¶ÆÁâ©ÁäíË≥ûËá™Â∑±ÂêßÔºÅ' },
            { id: 'cash_200', type: 'coupon', symbol: 'ü™ô', weight: 100, image: '', text: 'üçÄ Âπ∏ÈÅãÂä†ÂÄçË≥ûÔºÅ', desc: 'ÂèÆÂèÆÂôπÔΩûÂ•ΩÈÅã‰æÜÊï≤ÈñÄÔºÅÈÄÅ‰∏ä„Äê200ÂÖÉË≥ºÁâ©Èáë„ÄëÔºåÁ•ùÊÇ®Ë≥ºÁâ©ÊÑâÂø´ÔºÅ' },
            { id: 'cash_100', type: 'coupon', symbol: 'ü™ô', weight: 300, image: '', text: '‚òï ËÅñË™ïÊöñÂøÉÁ¶ÆÔºÅ', desc: 'ÊöñÊöñÂøÉÊÑèÈÄÅÁµ¶ÊÇ®ÔºÅÁç≤Âæó„Äê100ÂÖÉË≥ºÁâ©Èáë„ÄëÔºåÁÇ∫ÈÄôÂÄãÂÜ¨Â§©Âä†Ê∫´ÔºÅ' },
            { id: 'gift_mix', type: 'gift', symbol: 'üéÅ', weight: 50, image: '', text: 'üéÅ ËÅñË™ïÂ•ΩÁ¶Æ‰∏âÈÅ∏‰∏Ä', desc: 'ÊÅ≠ÂñúÁç≤ÂæóÂØ¶È´îÂ•ΩÁ¶ÆÂÖåÊèõË≥áÊ†ºÔºÅ\nË´ãËá≥Ê´ÉÂè∞Âá∫Á§∫Áï´Èù¢ÔºåÂç≥ÂèØÂæû‰ª•‰∏ãÂ•ΩÁ¶Æ **‰ªªÈÅ∏‰∏ÄÊ®£** Â∏∂ÂõûÂÆ∂Ôºö\n\n‚ú® ÊôÇÂ∞öÁõ•Ê¥óÂåÖ\n‚ú® Èò≤Áñ´ÂÆàË≠∑Âè£ÁΩ©\n‚ú® ËºïÊóÖÁâôÂà∑ÁµÑ' }
        ];

        function getRandomPrize() {
            let totalWeight = 0;
            prizes.forEach(p => totalWeight += p.weight);
            let randomNum = Math.random() * totalWeight;
            for (let i = 0; i < prizes.length; i++) {
                randomNum -= prizes[i].weight;
                if (randomNum <= 0) return prizes[i];
            }
            return prizes[prizes.length - 1];
        }

        const reel1 = document.getElementById('reel1');
        const reel2 = document.getElementById('reel2');
        const reel3 = document.getElementById('reel3');
        const spinBtn = document.getElementById('spinBtn');
        const statusMsg = document.getElementById('status-msg');

        function playGame() {
            testCount++;
            // Êõ¥Êñ∞ÁãÄÊÖãÂàóÈ°ØÁ§∫Ê¨°Êï∏
            if(statusMsg && userName) {
                 statusMsg.innerText = `${userName} Â∑≤ÈÅäÁé©Á¨¨ ${testCount} Ê¨°`;
            } else if (statusMsg) {
                 statusMsg.innerText = `ÁõÆÂâçÂ∑≤Ê∏¨Ë©¶Ôºö${testCount} Ê¨°`;
            }

            spinBtn.disabled = true;
            spinBtn.innerText = "Â•ΩÈÅãÈÅãËΩâ‰∏≠...";
            
            let interval = setInterval(() => {
                reel1.innerText = ["üéÖ","üéÑ","üéÅ","üí∞"][Math.floor(Math.random()*4)];
                reel2.innerText = ["üéÖ","üéÑ","üéÅ","üí∞"][Math.floor(Math.random()*4)];
                reel3.innerText = ["üéÖ","üéÑ","üéÅ","üí∞"][Math.floor(Math.random()*4)];
            }, 100);

            let result = getRandomPrize();

            setTimeout(() => {
                clearInterval(interval);
                reel1.innerText = result.symbol;
                reel2.innerText = result.symbol;
                reel3.innerText = result.symbol;

                setTimeout(() => { showModal(result); }, 500);

                spinBtn.innerText = "ÂÜçË©¶‰∏ÄÊ¨°";
                spinBtn.disabled = false;
            }, 1000);
        }

        function showModal(prize) {
            const modal = document.getElementById('prizeModal');
            document.getElementById('modalTitle').innerText = prize.text;
            document.getElementById('modalDesc').innerText = prize.desc;
            const imgDiv = document.getElementById('modalImg');
            if (prize.image) {
                imgDiv.innerHTML = `<img src="${prize.image}" alt="prize">`;
            } else {
                imgDiv.innerText = prize.symbol;
            }
            modal.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('prizeModal').style.display = 'none';
        }

        // ÂïüÂãï LINE ÈÄ£Á∑ö
        window.onload = function() {
            initLineLiff();
        };
    </script>
</body>
</html>
